# =============================================================================
# i3wm Config - Professional Pentest Layout (Final Fixed)
# =============================================================================

# Define a tecla Super como principal
set $mod Mod4

# --- FIX DO ALT (MOD1) ---
# Limpa as máscaras de modificadores e atribui corretamente cada tecla
# Isso resolve o problema de o Alt não ser reconhecido em editores/terminais
exec_always --no-startup-id xmodmap -e "clear mod1" -e "add mod1 = Alt_L Alt_R"
exec_always --no-startup-id xmodmap -e "clear mod4" -e "add mod4 = Super_L Super_R"

# --- SUPORTE AO MOUSE ---
# Garante que Super + Clique mova janelas, liberando o Alt para o Micro/Terminal
floating_modifier $mod
tiling_drag modifier titlebar

# --- FONTE ---
font pango:JetBrainsMono Nerd Font 10

# --- AUTOSTART ---
exec --no-startup-id nm-applet
exec --no-startup-id /usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1
exec_always --no-startup-id picom --config ~/.config/picom/picom.conf
exec_always --no-startup-id bash ~/.config/polybar/launch.sh --hack
exec_always --no-startup-id "killall greenclip; greenclip daemon"
exec --no-startup-id dex --autostart --environment i3
exec_always --no-startup-id feh --bg-fill /usr/share/wallpapers/KaliTiles/contents/images/3840x2160.jpg

# --- ESTÉTICA & GAPS ---
default_border pixel 0
default_floating_border pixel 0
for_window [class="^.*"] border pixel 0
gaps inner 2
gaps outer 2
smart_gaps on

# --- CORES DO TEMA ---
client.focused          #4c7899 #285577 #ffffff #2e9ef4   #285577
client.focused_inactive #333333 #5f676a #ffffff #484e50   #5f676a
client.unfocused        #333333 #222222 #888888 #292d2e   #222222
client.urgent           #2f343a #900000 #ffffff #900000   #900000

# --- ATALHOS DE APLICATIVOS ---
bindsym $mod+t exec kitty
bindsym $mod+q kill
bindsym $mod+e exec dolphin
bindsym $mod+a exec "rofi -modi drun,run -show drun -theme ~/.config/rofi/launchers/type-3/style-1.rasi"
bindsym $mod+v exec --no-startup-id rofi -modi "clipboard:greenclip print" -show clipboard -run-command '{cmd}' -theme ~/.config/rofi/launchers/type-3/style-1.rasi

# --- NAVEGAÇÃO ENTRE JANELAS ---
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# --- MOVIMENTAÇÃO DE JANELAS ---
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# --- LAYOUT CONTROL ---
bindsym $mod+b split h
bindsym $mod+Shift+v split v
bindsym $mod+f fullscreen toggle
bindsym $mod+Shift+space floating toggle

# --- NAVEGAÇÃO DINÂMICA DE WORKSPACES ---
bindsym Control+$mod+Right exec --no-startup-id i3-msg workspace number $(($(i3-msg -t get_workspaces | jq '.[] | select(.focused==true).num') + 1))
bindsym Control+$mod+Left exec --no-startup-id i3-msg workspace number $(($(i3-msg -t get_workspaces | jq '.[] | select(.focused==true).num') - 1))

# --- WORKSPACES FIXOS ---
set $ws1 "1: 1"
set $ws2 "2: 2"
set $ws3 "3: 3"
set $ws4 "4: 4"
set $ws5 "5: 5"

bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5

bindsym $mod+Shift+1 move container to workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5

# --- MODO REDIMENSIONAR ---
mode "resize" {
    bindsym Left resize shrink width 10 px or 10 ppt
    bindsym Down resize grow height 10 px or 10 ppt
    bindsym Up resize shrink height 10 px or 10 ppt
    bindsym Right resize grow width 10 px or 10 ppt
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

# --- CONTROLE DO I3 ---
bindsym $mod+Shift+c reload
bindsym $mod+Shift+r restart
bindsym $mod+w floating toggle

# --- CAPTURA DE TELA ---
# Mapeado para Super + P como você usa nas suas macros do Keychron
bindsym $mod+p exec flameshot gui
bindsym Print exec flameshot gui

# --- MULTIMÍDIA ---
bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +5%
bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -5%
bindsym XF86AudioMute exec --no-startup-id pactl set-sink-mute @DEFAULT_SINK@ toggle

bindsym Mod1+Shift+x exec notify-send "i3 recebeu o Alt"
